{# The recipe submission page #}
{# A single recipe page #}

{% extends "base.html" %}
{% block title %}Recipe Submit{% endblock %}
{%block pageId%}submit{%endblock%}
{% block article %}
	<section id="upload-form" class="content">

		{% if user.is_authenticated %}
			<form id="new-recipe" name="new-recipe" action="." method="POST"enctype="multipart/form-data">
				<h1 id="instructions">Enter your recipe.</h1>
				<p class="intro">Enter your recipe below for other to enjoy and then scrutinize meticulously showing no mercy! Enjoy!</p>
		
				<div id="form-messages">
				{% if form.errors %}
					<h2><strong>Button Up Soldier!</strong> Your recipe is not ship shape!</h2> 
				    <ul>
				    {% for error in form.errors %}
				        <li><strong>{{ error|escape }}</strong></li>
				    {% endfor %}
				    </ul>
				{% endif %}
				</div>
				{% csrf_token %}
				<fieldset>
				<div>
		        	<label for="id_name">Recipe Name:<abbr class="required">*</abbr></label>
		        	{{ form.name }}
		       	</div>
				<div>
		        	<label for="id_name">Recipe Description:<abbr class="required">*</abbr></label>
		        	{{ form.summary }}
		       	</div>
				<fieldset id="ingredients-list">
					<legend>Ingredients<abbr class="required">*</abbr></legend>
					<div id="ingredientWrap">
						<div class="ingredientEntry">
							<label for="ingredient" class="what">Ingredient:</label>
							<input type="text" class="ingredient" placeholder="e.g. salt" />
							<label for="measurement" class="how-much">Amount:</label>
							<input type="text" class="measurement" placeholder="e.g. 1 tbsp" />
						</div>
					</div>
					<button id="add-another">+ Add another ingredient</button>
					{{ form.ingredients }}		
				</fieldset>

				<div>
					<label for="id_instructions">Directions:<abbr class="required">*</abbr></label>
					{{ form.instructions }}
				</div>
				<div>	
					<label for="picture">Image:</label>
					{{ form.photo }}
				</div>
				<div>	
					<label for="id_yields">Number of servings:</label>
					{{ form.yields }}
				</div>
				<div>
					<label for="id_durations">Total time required:</label>
					{{ form.durations }}
				</div>
				<div>
					<label for="id_tags">How would you describe this recipe?<abbr class="required">*</abbr></label>
					{{ form.tags }}
					<em class="note">Seperate tags with commas e.g. spicy,italian</em>
				</div>
				<div class="controls">
				<input type="submit" value="Submit your recipe">
				</div>
				<fieldset>
			</form>
		{% else %}
			<script>
				window.location("/accounts/login");
			</script>
		{% endif%}
	</section>
{% endblock article %}
{% block rightColumn %}
{% endblock rightColumn %}
 <!--Right Column Article Template-->

{% block jsincludes %}
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.8.1/jquery.validate.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.min.js"></script>
{% endblock %}
{% block javaScript %}

$("#add-another").click(function(){
	var ingrhtml = $("#ingredientWrap .ingredientEntry:first").clone();
	ingrhtml.find(".measurement,.ingredient").val("")
	$("#ingredientWrap").append(ingrhtml);
	return false;
});

$("#new-recipe").submit(function(){
	var ings="";
	var count=0;
	var sl = $("#ingredientWrap .ingredientEntry")
	sl.each(function(){
		var el = $(this);
		count+=1;
	    var mes = el.find(".measurement").val();
	    var ing = el.find(".ingredient").val();
	    ings += mes+";"+ing;
	    if(count != sl.length){
			ings+=","
		}
	});
	$("#id_ingredients").val(ings);
});

$("#id_tags").autocomplete(
    '/ajax/tag/autocomplete',
    {multiple:true,multipleSeparator:','}
);

{% endblock javaScript %}