{# The recipe submission page #}
{# A single recipe page #}

{% extends "base.html" %}
{% block title %}{{ block.super }} - {{ name }}{% endblock %}
{% block article %}
	<section id="upload-form" class="content">
		<h1 id="instructions">Hello {{ user.username }} welcome to the upload page.</h1>

		{% if user.is_authenticated %}
			<form id="new-recipe" name="new-recipe" action="." method="POST"enctype="multipart/form-data">
				{% csrf_token %}
				{{ form.name.errors }}
		        <label for="id_name">Recipe Name:</label>
		        {{ form.name }}
				<fieldset id="ingredients-list">
					<legend>Ingredients</legend>
					{{ form.ingredients.errors }}
					<div id="ingredientWrap">
					<div class="ingredientEntry">
						<input type="text" class="measurement" placeholder="1 tbsp" />
						<label for="measurement" class="how-much">How much?</label>
						<input type="text" class="ingredient" placeholder="salt" />
						<label for="ingredient" class="what">What should I put in it?</label>
					</div>
					</div>
					<button id="add-another">+ Add another ingredient</button>
					{{ form.ingredients }}		
				</fieldset>
				<fieldset id="directions-list">
					<label for="id_instructions">Directions</label>
					{{ form.instructions.errors }}
					{{ form.instructions }}		
				</fieldset>
				<fieldset id="media">
					<label for="picture">Image</label>
					{{ form.photo.error }}
					{{ form.photo }}
				</fieldset>
				<fieldset>
					<label for="id_yields">How many people does this recipe serve?</label>
					{{ form.yields.errors }}
					{{ form.yields }}
					<label for="id_durations">How long does the dish take to create?</label>
					{{ form.durations.errors }}
					{{ form.durations }}
					<label for="id_tags">How would you describe this dish? (spicy, indian, quick)</label>
					{{ form.tags.errors }}
					{{ form.tags }}
				</fieldset>
				<input type="submit" value="Submit your recipe">
			</form>
		{% else %}
			<script>
				window.location("/accounts/login");
			</script>
		{% endif%}
	</section>
{% endblock article %}
{% block rightColumn %}
{% endblock rightColumn %}
 <!--Right Column Article Template-->


{% block javaScript %}

$("#add-another").click(function(){
	var ingrhtml = $("#ingredientWrap .ingredientEntry:first").clone();
	$("#ingredientWrap").append(ingrhtml);
	return false;
});

$("#new-recipe").submit(function(){
	var ings="";
	var count=0;
	var sl = $("#ingredientWrap .ingredientEntry")
	sl.each(function(){
		var el = $(this);
		count+=1;
	    var mes = el.find(".measurement").val();
	    var ing = el.find(".ingredient").val();
	    ings += mes+";"+ing;
	    if(count != sl.length){
			ings+=","
		}
	});
	$("#id_ingredients").val(ings);
});


{% endblock javaScript %}