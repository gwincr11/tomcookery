{# The recipe submission page #}
{# A single recipe page #}

{% extends "base.html" %}
{% block title %}Recipe Submit{% endblock %}
{%block pageId%}submit{%endblock%}
{% block article %}
	<section id="upload-form" class="content">

		{% if user.is_authenticated %}
			<form id="new-recipe" name="new-recipe" action="." method="POST"enctype="multipart/form-data">
				<h1 id="instructions">Enter your recipe below.</h1>
				<p class="intro">Enter your recipe below for other to enjoy and then scrutinize meticoulessly with no mercy, enter at your own will! MWAHAHAH!</p>
				{% csrf_token %}
				<fieldset>
				<div>
		        	<label for="id_name">Recipe Name:<abbr class="required">*</abbr></label>
		        	{{ form.name.errors }}
		        	{{ form.name }}
		       	</div>

				<fieldset id="ingredients-list">
					<legend>Ingredients:<abbr class="required">*</abbr></legend>
					{{ form.ingredients.errors }}
					<div id="ingredientWrap">
						<div class="ingredientEntry">
							<label for="measurement" class="how-much">Ingredient Amount:</label>
							<input type="text" class="measurement" placeholder="1 tbsp" />
							<label for="ingredient" class="what">Ingredient:</label>
							<input type="text" class="ingredient" placeholder="salt" />
						</div>
					</div>
					<button id="add-another">+ Add another ingredient</button>
					{{ form.ingredients }}		
				</fieldset>

				<div>
					<label for="id_instructions">Directions:<abbr class="required">*</abbr></label>
					{{ form.instructions.errors }}
					{{ form.instructions }}
				</div>
				<div>	
					<label for="picture">Image</label>
					{{ form.photo.error }}
					{{ form.photo }}
				</div>
				<div>	
					<label for="id_yields">Number of servings:</label>
					{{ form.yields.errors }}
					{{ form.yields }}
				</div>
				<div>
					<label for="id_durations">Total time required:</label>
					{{ form.durations.errors }}
					{{ form.durations }}
				</div>
				<div>
					<label for="id_tags">How would you describe this dish?<abbr class="required">*</abbr></label>
					{{ form.tags.errors }}
					{{ form.tags }}
					<em class="note">Seperate tags with commas e.g. spicy,italian</em>
				</div>
				<div class="controls">
				<input type="submit" value="Submit your recipe">
				</div>
				<fieldset>
			</form>
		{% else %}
			<script>
				window.location("/accounts/login");
			</script>
		{% endif%}
	</section>
{% endblock article %}
{% block rightColumn %}
{% endblock rightColumn %}
 <!--Right Column Article Template-->

{% block jsincludes %}<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.8.1/jquery.validate.js"></script>{% endblock %}
{% block javaScript %}

$("#add-another").click(function(){
	var ingrhtml = $("#ingredientWrap .ingredientEntry:first").clone();
	$("#ingredientWrap").append(ingrhtml);
	return false;
});

$("#new-recipe").submit(function(){
	var ings="";
	var count=0;
	var sl = $("#ingredientWrap .ingredientEntry")
	sl.each(function(){
		var el = $(this);
		count+=1;
	    var mes = el.find(".measurement").val();
	    var ing = el.find(".ingredient").val();
	    ings += mes+";"+ing;
	    if(count != sl.length){
			ings+=","
		}
	});
	$("#id_ingredients").val(ings);
});


{% endblock javaScript %}